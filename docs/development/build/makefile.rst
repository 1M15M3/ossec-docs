.. _build_makefile:

Makefile
========

OSSEC is using (starting with 2.9) a single Makefile to build the binaries
for each installation type.
The Makefile uses features of `GNU make <http://www.gnu.org/software/make/>`_,
and it is a requirement of the build process.
The make system attempts to perform all necessary tasks in a single run.
The type of installation must be specified when executed because there
is no state stored between executions.


Settings
--------

All changes to the makefile that take external input should be reported
via the settings build step. This allows troubleshooting and review of
the environment, and the hope is that some new features will become
discoverable for other developers.

.. code-block:: console 

    % make DATABASE=mysql TARGET=server USE_ZEROMQ=1 USE_GEOIP=1 settings

    General settings:
        TARGET:          server
        V:
        DEBUG:
        DEBUGAD
        PREFIX:          /var/ossec
        MAXAGENTS:       2048
        DATABASE:        mysql
    User settings:
        OSSEC_GROUP:     ossec
        OSSEC_USER:      ossec
        OSSEC_USER_MAIL: ossecm
        OSSEC_USER_REM:  ossecr
    Lua settings:
        LUA_PLAT:       macosx
    USE settings:
        USE_ZEROMQ:     1
        USE_GEOIP:      1
        USE_PRELUDE:    0
    Mysql settings:
        includes:       -I/usr/include/mysql/
        libs:           -L/usr/lib/mysql -lmysqlclient
    Pgsql settings:
        includes:
        libs:
    Defines:
        -DMAX_AGENTS=2048 -DOSSECHIDS -DDarwin -DHIGHFIRST -DZEROMQ_OUTPUT  -DGEOIP -DUMYSQL
    Compiler:
        CFLAGS          -DMAX_AGENTS=2048 -DOSSECHIDS -DDarwin -DHIGHFIRST -DZEROMQ_OUTPUT  -DGEOIP -DUMYSQL  -Wall -Wextra -O2 -I./ -I./headers/
        LDFLAGS         -lzmq -lczmq -lGeoIP -L/usr/lib/mysql -lmysqlclient
        CC              cc
        MAKE            /Applications/Xcode.app/Contents/Developer/usr/bin/make



Options / Varaiables
--------------------

.. envvar:: TARGET 

    Defines the type of installation to build.

    **Allowed:** server/agent/hybrid/local 

.. envvar:: V

    V is for verbose, and will instructure make to display full output without color. 

    **Applies to Target:** all
    
    **Default:** 0 

    **Allowed:** 0/1

.. envvar:: PREFIX 

    PREFIX is to be set with the installation base path.  

    .. warning::

       Please note that paths with SPACES and tabs in them are not supported and
       may cause compilation or runtime issues. 

    **Applies to Target:** all

    **Default:** /var/ossec 

    **Allowed:** All valid paths 

.. envvar:: MAXAGENTS 

    OSSEC is compiled with a max number of agents on the server/hybrid TARGETS.  This 
    varaiable allows users to select values expected for their environment. 

    **Applies to Target:** server/hybrid 

    **Default:** 2048 

    **Allowed:**  [2 - 65000]

.. envvar:: DEBUG 

    Enable debug symbols in all compiled programs.  

    **Applies to Target:** all

    **Default:** 0

    **Allowed:** 0/1

.. envvar:: DEBUGAD 

    Enable extra debuging logging in ossec-analysisd 

    **Applies to Target:** server/hybrid 

    **Default:** 0

    **Allowed:** 0/1

.. envvar:: OSSEC_USER 

    **Default:** ossec 


.. envvar:: OSSEC_GROUP

    **Default:** ossec 

.. envvar:: OSSEC_USER_MAIL

    **Default:** ossecm

.. envvar:: OSSEC_USER_REM

    **Default:** ossecr

.. envvar:: LUA_PLAT 

    What platform to pass to lua for building. 

    This is autogenerated for each install. 

    **Applies to Target:** all

.. envvar:: USE_GEOIP 

    Enables support for MAX Mind GeoIP looks on output. 

    **Applies to Target:** server/hybrid/local

    **Default:** 0

    **Allowed:** 0/1

.. envvar:: USE_PRELUDE

    Enables support for prelude output 

    **Applies to Target:** server/hybrid/local

    **Default:** 0

    **Allowed:** 0/1
    
.. envvar:: USE_ZEROMQ

    Enables support for zeromq output

    **Applies to Target:** server/hybrid/local 

    **Default:** 0

    **Allowed:** 0/1

.. envvar:: DATABASE 

    This selects the database enviromnet to enable.  

    **Applies to Target:** server/hybrid/local

    **Defaults:** 

    **Allowed:** mysql|pgsql 



